<!DOCTYPE html>
<html lang="en-US">
<html>

<head>
	<title> My First HTML</title>
	<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.js'></script>
	<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.css' rel='stylesheet' />
	<meta harset='UTF-8' name="viewport" content="width=device-width, initial-scale=1.0">
	<style>
		body { background-color:rgb(119, 209, 224); margin:0; padding:0; }
	</style>
</head>

<body>

<h1 style="font-size:20px;font-family:verdana;text-align:center"> Ageagle - Map and Weather Demo</h1>
<script>
function mclick(obj){
//var weatherCall = "api.openweathermap.org/data/2.5/weather?lat="+clat+"&lon="+clon&"APPID=994e83c3f27d62c4d9326872d8a50839";
//var weather = json.parse(JSON.stringify(weatherCall));
obj.style.color=rgb(255,0,0);
}
</script>

<pre id='coordinates'></pre>
<pre id='weatherinfo'> Temp: </pre>
<div  id="map" tabindex="0" ariel-label="Map" style="position: absolute; width: 100vw; height: 50vh;"></div>

<script>
mapboxgl.accessToken = 'pk.eyJ1IjoiYW94a3JpZ2FuIiwiYSI6ImNqdWJtZmxldTBmNDUzeXBiaGZhbnIzcG4ifQ.1QHixzzDq0uRwzqvxUNrvw';
var map = new mapboxgl.Map({
container: 'map',
style: 'mapbox://styles/mapbox/outdoors-v11'
});

map.on('click', function (e) {


// document.getElementById('coordinates').innerHTML =
// e.point is the x, y coordinates of the mousemove event relative
// to the top-left corner of the map
JSON.stringify(e.point) + '<br />' +
// e.lngLat is the longitude, latitude geographical position of the event
JSON.stringify(e.lngLat);
var coord;
var sys;
var weather;
var main;
var wind;
var rain;
var clouds;
var dt;
var id;
var name;
var cod;
var lat
var lng
document.getElementById("map").addEventListener("click",showWeather);
function showWeather(){
	var coords = JSON.parse(JSON.stringify(e.lngLat));
	lat = coords.lat;
	lng = coords.lng;
	// var key =	"994e83c3f27d62c4d9326872d8a50839";
	// var key = "fc767968e5613a670aebd679e70115b2";
	var key = "ac085af24fbf908d878aacfec0a41de7";
	var weatherURL = "https://api.openweathermap.org/data/2.5/weather?lat="+lat.toString()+"&lon="+lng.toString()+"&APPID=ac085af24fbf908d878aacfec0a41de7";
	var weatherParsed = JSON.parse(JSON.stringify(weatherURL));
	console.log(weatherURL);
	fetch(weatherURL)
	.then(response => {
    return response.json()
  })
  .then(data => {
    // Work with JSON data here
		console.log(data)
	document.getElementById('weatherinfo').innerHTML = " Temp: "+data.main.temp;

  })
  .catch(err => {
    // Do something for an error here
  })
	
}


});

</script>


</html>